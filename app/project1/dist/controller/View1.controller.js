sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/BusyIndicator","sap/ui/core/Fragment"],function(e,t,n,o,i,s,r){"use strict";return e.extend("project1.controller.View1",{_getUrl:function(){return sap.ui.require.toUrl("project1")},onInit:function(){const e=new n([]);this.getView().setModel(e,"attachmentModel");this._fetchVendors();this._intervalId=setInterval(()=>{this._fetchVendors()},1e4);this._createDialog=null;this.selectedFiles=null},onExit:function(){if(this._intervalId){clearInterval(this._intervalId);this._intervalId=null}},_fetchVendors:function(){var e=this._getUrl()+`/odata/v4/vendor/Vendors`;console.log(e);fetch(e).then(e=>e.json()).then(e=>{const t=this.getView().getModel("VendModel");if(t){t.setData(e.value)}else{this.getView().setModel(new n(e.value),"VendModel")}this._reapplyFilters()}).catch(e=>{console.error("Failed to fetch vendors:",e)})},_reapplyFilters:function(){const e=this.byId("vendorTable");const t=e.getBinding("items");const n=this.byId("vendorIdFilter").getValue();const s=this.byId("vendorNameFilter").getValue();const r=this.byId("statusFilter").getValue();const a=[];if(n)a.push(new o("ID",i.Contains,n));if(s)a.push(new o("name",i.Contains,s));if(r)a.push(new o("status",i.Contains,r));t.filter(a)},onVendorSelect:function(e){const t=e.getParameter("listItem").getBindingContext("VendModel").getProperty("ID");const n=sap.ui.core.UIComponent.getRouterFor(this);n.navTo("View2",{vendor_Id:t})},onCreateVendor:function(){if(!this._createDialog){r.load({name:"project1.view.CreateVendor",controller:this}).then(e=>{this._createDialog=e;this.getView().addDependent(e);e.open()})}else{this._createDialog.open()}},onFileChange:function(e){this.selectedFiles=e.getParameter("files");console.log("Selected files:",this.selectedFiles)},onCancelVendor:function(){this._createDialog.close()},onDialogClose:function(){sap.ui.getCore().byId("newVendorId").setValue("");sap.ui.getCore().byId("newVendorName").setValue("");sap.ui.getCore().byId("newVendorEmail").setValue("");sap.ui.getCore().byId("newVendorPhone").setValue("");sap.ui.getCore().byId("newFileUploader").clear();this.selectedFiles=null},_isValidEmail:function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},_isValidPhone:function(e){return/^\d{10}$/.test(e)},getCSRFToken:async function(e){try{const t=await fetch(e,{method:"GET",headers:{"X-CSRF-Token":"Fetch"}});return t.headers.get("x-csrf-token")}catch(e){console.error("CSRF Token fetch failed:",e);return null}},onSubmitNewVendor:async function(){const e=sap.ui.getCore().byId("newVendorId").getValue();const n=sap.ui.getCore().byId("newVendorName").getValue();const o=sap.ui.getCore().byId("newVendorEmail").getValue();const i=sap.ui.getCore().byId("newVendorPhone").getValue();if(!n||!o||!i||!e||!this.selectedFiles||this.selectedFiles.length===0){t.show("Please fill in all vendor details and upload at least one file.");return}if(!this._isValidEmail(o)){t.show("Please enter a valid email address.");return}if(!this._isValidPhone(i)){t.show("Please enter a valid 10-digit phone number.");return}try{s.show(0);const r={ID:e,name:n,email:o,phone:i};const a=await this.getCSRFToken("odata/v4/vendor/");const l=this._getUrl()+`/odata/v4/vendor/VendorCreation`;const d=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":a},body:JSON.stringify(r)});if(!d.ok)throw new Error("Vendor creation failed: "+await d.text());for(let t of this.selectedFiles){const n=new FormData;n.append("file",t);n.append("vendorID",e);const o=this._getUrl()+`/uploadPDF`;const i=await fetch(o,{method:"POST",body:n});if(!i.ok){throw new Error(`Failed to upload file: ${t.name}`)}}t.show("Vendor and file uploaded successfully.");this._createDialog.close();this.onDialogClose();await this._fetchVendors()}catch(e){console.error("Error:",e);t.show("Error occurred during vendor or file upload.")}finally{s.hide()}},onFilter:function(){this._reapplyFilters()}})});
//# sourceMappingURL=View1.controller.js.map