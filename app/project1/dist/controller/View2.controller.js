sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/model/json/JSONModel"],function(e,t,o){"use strict";return e.extend("project1.controller.View2",{onInit:function(){const e=this.getOwnerComponent().getRouter();var t=e.getRoute("View2");if(t){t.attachPatternMatched(this._onRouteMatched,this)}else{console.error("Route 'View2' not found! Check manifest.json for routing config.")}},_approvers:function(e){fetch(`odata/v4/vendor/VendorApprovals?vendor_ID=${e}`,{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{const t=e.value.sort((e,t)=>e.level-t.level);const n=new o(t);this.getView().setModel(n,"VendModel1");this.byId("busyIndicator").setVisible(false)}).catch(e=>{console.error("Approvals fetch error:",e);t.show("Failed to fetch vendor approval data.");this.byId("busyIndicator").setVisible(false)})},_onRouteMatched:function(e){const n=e.getParameter("arguments").vendor_Id;this.byId("vendorIdText").setText("Vendor ID: "+n);this.byId("busyIndicator").setVisible(true);this.getView().setModel(new o({files:[]}),"attachmentModel");fetch(`odata/v4/vendor/download?vendor_ID=${n}`,{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{const t=new o({files:e.value});this.getView().setModel(t,"attachmentModel");this.byId("busyIndicator").setVisible(false)}).catch(e=>{console.error("Error:",e);t.show("Failed to fetch files.");this.byId("busyIndicator").setVisible(false)});this._approvers(n);clearInterval(this._approverInterval);this._approverInterval=setInterval(()=>{this._approvers(n)},1e4)},onDownloadPress:function(e){const t=e.getSource().getBindingContext("attachmentModel");const{fileName:o,content:n,mimeType:s}=t.getProperty();const r=atob(n);const a=Array.from(r,e=>e.charCodeAt(0));const c=new Uint8Array(a);const i=new Blob([c],{type:s});const d=URL.createObjectURL(i);const l=document.createElement("a");l.href=d;l.download=o;document.body.appendChild(l);l.click();document.body.removeChild(l);URL.revokeObjectURL(d)},onDownloadAll:function(){const e=this.getView().getModel("attachmentModel").getProperty("/files");if(!e||!e.length){sap.m.MessageToast.show("No files to download.");return}const t=new JSZip;e.forEach(e=>{const o=atob(e.content);const n=new Uint8Array([...o].map(e=>e.charCodeAt(0)));t.file(e.fileName,n,{binary:true})});t.generateAsync({type:"blob"}).then(e=>{const t=URL.createObjectURL(e);const o=document.createElement("a");o.href=t;o.download="attachments.zip";document.body.appendChild(o);o.click();document.body.removeChild(o);URL.revokeObjectURL(t)})}})});
//# sourceMappingURL=View2.controller.js.map